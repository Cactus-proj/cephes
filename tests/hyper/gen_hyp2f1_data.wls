(* gen_hyp2f1_data.wls *)
(* This script generates test data for the Gauss Hypergeometric function 2F1(a, b; c; x) *)
(* and exports it to a C++ header for use in TableValues tests. *)

(* Parameter Ranges *)
aVals = Range[-3.0, 3.0, 0.5];
bVals = Range[-3.0, 3.0, 0.5];
cVals = {0.5, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0};
xVals = {-0.9, -0.6, -0.3, 0.0, 0.3, 0.6, 0.9, 0.999};

(* Output header path *)
outputFile = "hyp2f1_data.h";

(* Formatting helpers *)
fmt[num_] := ToString[CForm[N[num]]];
fmtRes[num_] := ToString[CForm[N[num, 17]]];

(* Open output stream *)
st = OpenWrite[outputFile];

(* C++ header prelude *)

WriteString[st, "// Generated by gen_hyp2f1_data.wls\n"];
WriteString[st, "// Test data for Gauss Hypergeometric function 2F1(a, b; c; x)\n"];
WriteString[st, "#pragma once\n\n"];

WriteString[st, "struct Hyp2f1TestCase {\n"];
WriteString[st, "    double a;\n"];
WriteString[st, "    double b;\n"];
WriteString[st, "    double c;\n"];
WriteString[st, "    double x;\n"];
WriteString[st, "    double expected;\n"];
WriteString[st, "};\n\n"];
WriteString[st, "static const Hyp2f1TestCase hyp2f1_data[] = {\n"];

(* TableValues generation *)
(* Note: We filter unstable/non-real outputs and restrict |x| < 1 for numeric stability. *)
Do[
  y = Hypergeometric2F1[a, b, c, x];
  If[NumericQ[N[y]] && !MatchQ[N[y], Indeterminate | ComplexInfinity] && Abs[x] < 1.0,
    WriteString[st, 
      StringJoin[
        "    {", fmt[a], ", ", fmt[b], ", ", fmt[c], ", ", fmt[x], ", ", fmtRes[y], "},\n"
      ]
    ];
  ];
  , {x, xVals}, {a, aVals}, {b, bVals}, {c, cVals}
];
WriteString[st, "};\n"];
Close[st];
